let e=`body`;async function t(t=location.href,n=`body`,r=!1){let i=document.querySelector(n);i?.setAttribute(`aria-busy`,`true`);let a=await fetch(t,{headers:{"htswap-target":n}}),o=new DOMParser().parseFromString(await a.text(),`text/html`),s=o.querySelector(n);if(!s||!i)return console.error(`HTSWAP: Target "${n}" not found`);i.outerHTML=s.outerHTML,e=n,r||history.pushState({target:n,fromUrl:location.href},``,t)}function n(){document.querySelectorAll(`[target]:not([data-assigned])`).forEach(e=>{if(e.tagName===`A`){let n=e;n.dataset.assigned=`true`,n.onclick=e=>{e.preventDefault(),t(n.href,n.getAttribute(`target`)||`body`,n.hasAttribute(`no-history`))}}e.tagName===`FORM`&&(e.onsubmit=n=>{n.preventDefault();let r=e.getAttribute(`action`)||location.pathname,i=new URLSearchParams(new FormData(e)).toString();t(r+(r.includes(`?`)?`&`:`?`)+i,e.getAttribute(`target`)||``)})})}function r(){n(),new MutationObserver(n).observe(document.documentElement,{childList:!0,subtree:!0}),window.addEventListener(`popstate`,n=>t(n.state?.fromUrl??`/`,n.state?.target??e,!0))}r();export{n as htswapAssign,r as htswapInit,t as htswapReplace};